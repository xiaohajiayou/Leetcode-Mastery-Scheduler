{"version":3,"file":"background.js","mappings":";;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,YAAY,oCAAoC;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,yDAAyD,wBAAwB;AACjF,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,aAAa;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,WAAW;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,MAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,oDAAoD,WAAW;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,aAAa,oBAAoB,4BAA4B;AACvF;AACA;AACA;AACA,cAAc,qBAAqB;AACnC,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,iBAAiB,WAAW;AAC5B;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA,0CAA0C;AAC1C;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC,2BAA2B,mDAAmD;AAC9E,UAAU;AACV;AACA,2BAA2B,0EAA0E;AACrG;AACA,qBAAqB;AACrB;AACA,CAAC,E","sources":["webpack://Leetcode-Mastery-Scheduler/./src/background/background.js"],"sourcesContent":["console.log('Background service worker started');\n\n// é»˜è®¤é…ç½®\nconst DEFAULT_SETTINGS = {\n    reminderEnabled: false,\n    reminderInterval: 60, // é»˜è®¤60åˆ†é’Ÿ\n    reminderStartTime: '09:00',\n    reminderEndTime: '22:00',\n    reminderDays: [1, 2, 3, 4, 5, 6, 0] // é»˜è®¤æ¯å¤©\n};\n\n// åˆå§‹åŒ–æ‰©å±•\nchrome.runtime.onInstalled.addListener(async () => {\n    console.log('Extension installed/updated');\n    \n    // åœ¨ Manifest V3 ä¸­ï¼Œnotifications æƒé™åœ¨ manifest ä¸­å£°æ˜åç›´æ¥å¯ç”¨\n    console.log('Notifications API ready');\n    \n    // åˆå§‹åŒ–è®¾ç½®\n    const settings = await chrome.storage.local.get(Object.keys(DEFAULT_SETTINGS));\n    const needsInit = Object.keys(DEFAULT_SETTINGS).some(key => !(key in settings));\n    \n    if (needsInit) {\n        await chrome.storage.local.set(DEFAULT_SETTINGS);\n        console.log('Initialized default settings');\n    }\n    \n    // è®¾ç½®å®šæ—¶å™¨\n    setupAlarms();\n});\n\n// ç›‘å¬å­˜å‚¨å˜åŒ–\nchrome.storage.onChanged.addListener((changes, namespace) => {\n    if (namespace === 'local' && changes.reminderEnabled) {\n        console.log('Reminder setting changed:', changes.reminderEnabled.newValue);\n        setupAlarms();\n    }\n});\n\n// è®¾ç½®é—¹é’Ÿ\nasync function setupAlarms() {\n    const { reminderEnabled, reminderInterval } = await chrome.storage.local.get([\n        'reminderEnabled',\n        'reminderInterval'\n    ]);\n    \n    // æ¸…é™¤ç°æœ‰é—¹é’Ÿ\n    await chrome.alarms.clear('dailyReminder');\n    \n    if (reminderEnabled) {\n        // åˆ›å»ºå‘¨æœŸæ€§é—¹é’Ÿ\n        chrome.alarms.create('dailyReminder', {\n            delayInMinutes: 1, // 1åˆ†é’Ÿåé¦–æ¬¡è§¦å‘\n            periodInMinutes: reminderInterval || 60\n        });\n        console.log(`Reminder alarm set with interval: ${reminderInterval || 60} minutes`);\n    } else {\n        console.log('Reminder disabled, alarms cleared');\n    }\n}\n\n// ç›‘å¬é—¹é’Ÿ\nchrome.alarms.onAlarm.addListener(async (alarm) => {\n    if (alarm.name === 'dailyReminder') {\n        await checkAndShowReminder();\n    }\n});\n\n// æ£€æŸ¥å¹¶æ˜¾ç¤ºæé†’\nasync function checkAndShowReminder() {\n    const settings = await chrome.storage.local.get([\n        'reminderEnabled',\n        'reminderStartTime',\n        'reminderEndTime',\n        'reminderDays',\n        'lastReminderTime',\n        'nextReminderDelay'\n    ]);\n    \n    if (!settings.reminderEnabled) {\n        return;\n    }\n    \n    // æ£€æŸ¥æ—¶é—´èŒƒå›´\n    const now = new Date();\n    const currentDay = now.getDay();\n    const currentTime = now.getHours() * 60 + now.getMinutes();\n    \n    // æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸çš„æ—¥æœŸ\n    const reminderDays = settings.reminderDays || DEFAULT_SETTINGS.reminderDays;\n    if (!reminderDays.includes(currentDay)) {\n        console.log('Not a reminder day');\n        return;\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦åœ¨å…è®¸çš„æ—¶é—´èŒƒå›´\n    const startTime = parseTime(settings.reminderStartTime || DEFAULT_SETTINGS.reminderStartTime);\n    const endTime = parseTime(settings.reminderEndTime || DEFAULT_SETTINGS.reminderEndTime);\n    \n    if (currentTime < startTime || currentTime > endTime) {\n        console.log('Outside reminder time range');\n        return;\n    }\n    \n    // æ£€æŸ¥å»¶è¿Ÿ\n    const lastReminderTime = settings.lastReminderTime || 0;\n    const nextReminderDelay = settings.nextReminderDelay || 0;\n    \n    if (nextReminderDelay > 0 && (now.getTime() - lastReminderTime) < nextReminderDelay) {\n        console.log('Still in delay period');\n        return;\n    }\n    \n    // è·å–å¾…å¤ä¹ é¢˜ç›®æ•°é‡\n    const problems = await getReviewProblems();\n    const reviewCount = problems.length;\n    \n    if (reviewCount > 0) {\n        console.log(`Found ${reviewCount} problems need review today`);\n        // æ˜¾ç¤ºé€šçŸ¥\n        showNotification(reviewCount);\n        \n        // æ›´æ–°æœ€åæé†’æ—¶é—´\n        await chrome.storage.local.set({\n            lastReminderTime: now.getTime(),\n            nextReminderDelay: 0\n        });\n    } else {\n        console.log('All problems for today have been reviewed!');\n    }\n}\n\n// è§£ææ—¶é—´å­—ç¬¦ä¸²\nfunction parseTime(timeStr) {\n    const [hours, minutes] = timeStr.split(':').map(Number);\n    return hours * 60 + minutes;\n}\n\n// è·å–å¾…å¤ä¹ é¢˜ç›®ï¼ˆæœªå®Œæˆçš„ï¼‰\nasync function getReviewProblems() {\n    try {\n        const { problems } = await chrome.storage.local.get('problems');\n        if (!problems || !Array.isArray(problems)) {\n            return [];\n        }\n        \n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        \n        // è¿‡æ»¤å‡ºä»Šå¤©éœ€è¦å¤ä¹ ä½†è¿˜æœªå¤ä¹ çš„é¢˜ç›®\n        return problems.filter(problem => {\n            // è·³è¿‡å·²åˆ é™¤çš„é¢˜ç›®\n            if (problem.isDeleted) return false;\n            \n            // æ£€æŸ¥æ˜¯å¦æœ‰ FSRS çŠ¶æ€\n            if (!problem.fsrsState) return false;\n            \n            // æ£€æŸ¥æ˜¯å¦ä»Šå¤©å·²ç»å¤ä¹ è¿‡\n            if (problem.fsrsState.lastReview) {\n                const lastReview = new Date(problem.fsrsState.lastReview);\n                lastReview.setHours(0, 0, 0, 0);\n                // å¦‚æœä»Šå¤©å·²ç»å¤ä¹ è¿‡ï¼Œåˆ™ä¸éœ€è¦æé†’\n                if (lastReview.getTime() === today.getTime()) {\n                    return false;\n                }\n            }\n            \n            // æ£€æŸ¥æ˜¯å¦åˆ°äº†å¤ä¹ æ—¶é—´\n            if (problem.fsrsState.nextReview) {\n                const nextReview = new Date(problem.fsrsState.nextReview);\n                nextReview.setHours(0, 0, 0, 0);\n                // å¦‚æœå¤ä¹ æ—¶é—´æ˜¯ä»Šå¤©æˆ–ä¹‹å‰ï¼Œéœ€è¦å¤ä¹ \n                return nextReview.getTime() <= today.getTime();\n            }\n            \n            return false;\n        });\n    } catch (error) {\n        console.error('Error getting review problems:', error);\n        return [];\n    }\n}\n\n// æ˜¾ç¤ºé€šçŸ¥\nasync function showNotification(reviewCount, isTest = false) {\n    // å…ˆæ¸…é™¤æ—§çš„é€šçŸ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n    try {\n        await chrome.notifications.clear('leetcodeReminder');\n    } catch (error) {\n        // å¿½ç•¥æ¸…é™¤é”™è¯¯\n    }\n    \n    // ä¸ºæµ‹è¯•é€šçŸ¥ä½¿ç”¨ä¸åŒçš„ IDï¼Œé¿å…å†²çª\n    const notificationId = isTest ? `leetcodeTest_${Date.now()}` : 'leetcodeReminder';\n    \n    const notificationOptions = {\n        type: 'basic',\n        iconUrl: chrome.runtime.getURL('assets/bear.png'),\n        title: isTest ? 'ğŸ‰ Test Notification' : 'LeetCode Review Reminder',\n        message: isTest \n            ? 'Great! Notifications are working properly. When enabled, you\\'ll receive reminders about your LeetCode review tasks at your scheduled intervals.'\n            : `You have ${reviewCount} unfinished problem${reviewCount > 1 ? 's' : ''} to review today. Keep your skills sharp!`,\n        priority: 2,\n        requireInteraction: !isTest, // æµ‹è¯•é€šçŸ¥ä¸éœ€è¦æ‰‹åŠ¨å…³é—­\n        buttons: isTest ? [] : [\n            { title: 'Review Now' },\n            { title: 'Remind in 30 min' }\n        ]\n    };\n    \n    chrome.notifications.create(notificationId, notificationOptions, (createdId) => {\n        if (chrome.runtime.lastError) {\n            console.error('Notification error:', chrome.runtime.lastError);\n        } else {\n            console.log('Notification created:', createdId);\n            // æµ‹è¯•é€šçŸ¥60ç§’åè‡ªåŠ¨æ¸…é™¤\n            if (isTest) {\n                setTimeout(() => {\n                    chrome.notifications.clear(createdId);\n                }, 60000);  // æ”¹ä¸º60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰\n            }\n        }\n    });\n}\n\n// å¤„ç†é€šçŸ¥ç‚¹å‡»\nchrome.notifications.onClicked.addListener((notificationId) => {\n    if (notificationId === 'leetcodeReminder') {\n        // æ‰“å¼€æ‰©å±•å¼¹çª—\n        chrome.action.openPopup();\n        chrome.notifications.clear(notificationId);\n    }\n});\n\n// å¤„ç†é€šçŸ¥æŒ‰é’®ç‚¹å‡»\nchrome.notifications.onButtonClicked.addListener(async (notificationId, buttonIndex) => {\n    if (notificationId === 'leetcodeReminder') {\n        if (buttonIndex === 0) {\n            // Review Now - æ‰“å¼€æ‰©å±•\n            chrome.action.openPopup();\n        } else if (buttonIndex === 1) {\n            // Remind Later - å»¶è¿Ÿ30åˆ†é’Ÿ\n            const delay = 30 * 60 * 1000; // 30åˆ†é’Ÿ\n            await chrome.storage.local.set({\n                lastReminderTime: Date.now(),\n                nextReminderDelay: delay\n            });\n            console.log('Reminder delayed for 30 minutes');\n        }\n        chrome.notifications.clear(notificationId);\n    }\n});\n\n// ç›‘å¬æ¥è‡ªpopupçš„æ¶ˆæ¯\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n    if (request.action === 'testNotification') {\n        // åœ¨ Manifest V3 ä¸­ï¼Œnotifications æƒé™åœ¨ manifest ä¸­å£°æ˜åç›´æ¥å¯ç”¨\n        try {\n            showNotification(5, true); // true è¡¨ç¤ºè¿™æ˜¯æµ‹è¯•é€šçŸ¥\n            sendResponse({ success: true, message: 'Test notification sent!' });\n        } catch (error) {\n            console.error('Error showing notification:', error);\n            sendResponse({ success: false, message: 'Failed to show notification: ' + error.message });\n        }\n        return true; // ä¿æŒæ¶ˆæ¯é€šé“å¼€æ”¾\n    }\n});"],"names":[],"sourceRoot":""}